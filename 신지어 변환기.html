<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>신지어 변환기</title>
<style>
body { font-family: sans-serif; padding: 2em; background: #f5f5f5; }
input, textarea { width: 100%; padding: 0.5em; margin: 0.5em 0; }
button { padding: 0.5em 1em; margin-top: 1em; }
</style>
</head>
<body>
<h1>신지어 ↔ 한국어 변환기</h1>
<textarea id="inputText" rows="3" placeholder="한국어 또는 신지어 입력"></textarea>
<button onclick="convert()">변환</button>
<h3>결과:</h3>
<div id="output"></div>

<script>
// -------------------------
// 자음/모음 매핑
// -------------------------
const consonant_to_code = {
    'ㄱ':'1','ㅋ':'1!','ㄲ':'1?','ㄴ':'2','ㄹ':'2!',
    'ㄷ':'3','ㅌ':'3!','ㄸ':'3?','ㅂ':'4','ㅍ':'4!',
    'ㅃ':'4?','ㅅ':'5','ㅎ':'5!','ㅆ':'5?','ㅈ':'6',
    'ㅊ':'6!','ㅉ':'6?','ㅇ':'7','ㅁ':'7!'
};

const vowel_to_code = {
    'ㅏ':'a','ㅑ':'a^','ㅐ':'af','ㅒ':'a^f','ㅔ':'bf','ㅖ':'b^f',
    'ㅓ':'b','ㅕ':'b^','ㅗ':'c','ㅛ':'c^','ㅜ':'d','ㅠ':'d^',
    'ㅡ':'e','ㅣ':'f','ㅚ':'cf','ㅢ':'ef','ㅙ':'caf','ㅟ':'df',
    'ㅝ':'db','ㅞ':'dbf','ㅘ':'ca'
};

const code_to_consonant = Object.fromEntries(Object.entries(consonant_to_code).map(([k,v])=>[v,k]));
const code_to_vowel = Object.fromEntries(Object.entries(vowel_to_code).map(([k,v])=>[v,k]));

const composite_jong_to_sinjieo = {
    'ㄳ':'15&','ㄵ':'26&','ㄶ':'25!&',
    'ㄺ':'12&','ㄻ':'27&','ㄼ':'24&','ㄽ':'25&',
    'ㄾ':'23!&','ㄿ':'24!&','ㅀ':'25!&','ㅄ':'45&'
};
const sinjieo_to_composite_jong = Object.fromEntries(Object.entries(composite_jong_to_sinjieo).map(([k,v])=>[v,k]));

const chosung_list = ['ㄱ','ㄲ','ㄴ','ㄷ','ㄸ','ㄹ','ㅁ','ㅂ','ㅃ','ㅅ','ㅆ','ㅇ','ㅈ','ㅉ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
const jungsung_list = ['ㅏ','ㅐ','ㅑ','ㅒ','ㅓ','ㅔ','ㅕ','ㅖ','ㅗ','ㅘ','ㅙ','ㅚ','ㅛ','ㅜ','ㅝ','ㅞ','ㅟ','ㅠ','ㅡ','ㅢ','ㅣ'];
const jongsung_list = ['','ㄱ','ㄲ','ㄳ','ㄴ','ㄵ','ㄶ','ㄷ','ㄹ','ㄺ','ㄻ','ㄼ','ㄽ','ㄾ','ㄿ','ㅀ','ㅁ','ㅂ','ㅄ','ㅅ','ㅆ','ㅇ','ㅈ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];

// -------------------------
// 한글 ↔ 신지어 변환
// -------------------------
function decomposeHangul(char){
    const code = char.charCodeAt(0);
    if (code < 0xAC00 || code > 0xD7A3) return null;
    const temp = code - 0xAC00;
    const jong = temp % 28;
    const jung = Math.floor(temp/28) % 21;
    const cho = Math.floor(temp/28/21);
    return [cho,jung,jong];
}

function hangul_to_sinjieo(text){
    let result = '';
    for(let char of text){
        if(char===' '){ result += '/'; continue; }
        const dec = decomposeHangul(char);
        if(dec){
            const [cho,jung,jong_idx] = dec;
            result += consonant_to_code[chosung_list[cho]];
            result += vowel_to_code[jungsung_list[jung]];
            const jong_char = jongsung_list[jong_idx];
            if(jong_char){
                if(composite_jong_to_sinjieo[jong_char]) result += composite_jong_to_sinjieo[jong_char];
                else result += consonant_to_code[jong_char];
            }
        } else { result += char; }
    }
    return result;
}

function sinjieo_to_hangul(code){
    let result=''; let i=0;
    while(i<code.length){
        if(code[i]==='/'){ result+=' '; i++; continue; }

        let cho=null, jung=null, jong='';
        // 초성
        for(let k of Object.keys(code_to_consonant).sort((a,b)=>b.length-a.length)){
            if(code.startsWith(k,i)){ cho=code_to_consonant[k]; i+=k.length; break; }
        }
        if(!cho){ result+=code[i]; i++; continue; }

        // 중성
        for(let k of Object.keys(code_to_vowel).sort((a,b)=>b.length-a.length)){
            if(code.startsWith(k,i)){ jung=code_to_vowel[k]; i+=k.length; break; }
        }
        if(!jung){ result+=cho; continue; }

        // 종성
        let matched=false;
        for(let [cj_code,cj] of Object.entries(sinjieo_to_composite_jong).sort((a,b)=>b[0].length-a[0].length)){
            if(code.startsWith(cj_code,i)){ jong=cj; i+=cj_code.length; matched=true; break; }
        }
        if(!matched){
            for(let k of Object.keys(code_to_consonant).sort((a,b)=>b.length-a.length)){
                if(code.startsWith(k,i)){
                    const candidate=code_to_consonant[k];
                    if(jongsung_list.includes(candidate)){
                        let next_vowel=false;
                        for(let v of Object.keys(code_to_vowel).sort((a,b)=>b.length-a.length)){
                            if(code.startsWith(v,i+k.length)){ next_vowel=true; break; }
                        }
                        if(!next_vowel){ jong=candidate; i+=k.length; }
                    }
                    break;
                }
            }
        }

        const cho_idx=chosung_list.indexOf(cho);
        const jung_idx=jungsung_list.indexOf(jung);
        const jong_idx=jongsung_list.indexOf(jong||'');
        result += String.fromCharCode(0xAC00 + (cho_idx*21+jung_idx)*28 + jong_idx);
    }
    return result;
}

// -------------------------
// 버튼 이벤트
// -------------------------
function convert(){
    const text=document.getElementById('inputText').value.trim();
    let output='';
    if(/^[1234567890!?abcdef^&\/]+$/.test(text)){
        output = sinjieo_to_hangul(text);
    } else {
        output = hangul_to_sinjieo(text);
    }
    document.getElementById('output').innerText = output;
}
</script>
</body>
</html>
